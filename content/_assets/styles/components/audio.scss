@use 'sass:math';

/**************************************************************************
 * Base Font size used for all relative lengths/sizes
 *************************************************************************/
 $base-font-size: 16px;

 /**************************************************************************
  * Universally useful conversion functions for lengths/sizes
  *************************************************************************/
 @function px-to-rem($pixels, $base: $base-font-size) {
   @return math.div($pixels, $base) * 1rem;
 }

//
// Function to create an optimized svg url
// Version: 1.0.6
@function svg-url($svg){
  //
  // Add missing namespace
  //
  @if not str-index($svg,xmlns) {
    $svg: str-replace($svg, '<svg','<svg xmlns="http://www.w3.org/2000/svg"');
  }
  //
  // Chunk up string in order to avoid
  // "stack level too deep" error
  //
  $encoded:'';
  $slice: 2000;
  $index: 0;
  $loops: ceil(math.div(str-length($svg), $slice));
  @for $i from 1 through $loops {
    $chunk: str-slice($svg, $index, $index + $slice - 1);
    //
    // Encode
    //
    $chunk: str-replace($chunk, '"', '\'');
    $chunk: str-replace($chunk, '%', '%25');
    $chunk: str-replace($chunk, '#', '%23');
    $chunk: str-replace($chunk, '{', '%7B');
    $chunk: str-replace($chunk, '}', '%7D');
    $chunk: str-replace($chunk, '<', '%3C');
    $chunk: str-replace($chunk, '>', '%3E');
    //
    // The maybe list
    //
    // Keep size and compile time down
    // ... only add on documented fail
    //
    // $chunk: str-replace($chunk, '&', '%26');
    // $chunk: str-replace($chunk, '|', '%7C');
    // $chunk: str-replace($chunk, '[', '%5B');
    // $chunk: str-replace($chunk, ']', '%5D');
    // $chunk: str-replace($chunk, '^', '%5E');
    // $chunk: str-replace($chunk, '`', '%60');
    // $chunk: str-replace($chunk, ';', '%3B');
    // $chunk: str-replace($chunk, '?', '%3F');
    // $chunk: str-replace($chunk, ':', '%3A');
    // $chunk: str-replace($chunk, '@', '%40');
    // $chunk: str-replace($chunk, '=', '%3D');
    $encoded: #{$encoded}#{$chunk};
    $index: $index + $slice;
  }
  @return url("data:image/svg+xml,#{$encoded}");
}
@mixin background-svg($svg){
  background-image: svg-url($svg);
}
// Helper function to replace characters in a string
@function str-replace($string, $search, $replace: '') {
  $index: str-index($string, $search);
  @return if($index,
  str-slice($string, 1, $index - 1) + $replace +
  str-replace(str-slice($string, $index +
  str-length($search)), $search, $replace),
  $string);
}

/* https://css-tricks.com/sliding-nightmare-understanding-range-input/ */

.audio-player-container {
  --seek-before-width: 0%;
  --volume-before-width: 100%;
  --buffered-width: 0%;
  max-width: px_to_rem(450px);
  width: auto;
  background: #fff; /* TODO: fix */
  border: px-to-rem(2px) solid $gray;
  font-family: 'FFMark narrow', sans-serif;
  padding: 1rem;

  button {
    &.mute-button, &.play-pause-button {
      background-color: transparent;
      background-origin: padding-box;
      background-position: center center;
      background-repeat: no-repeat;
      background-size: contain;
      border: 0;
      color: transparent !important;
      cursor: pointer;
      display: inline-block;
      height: px-to-rem(40px);
      outline: none;
      overflow: hidden;
      padding: 0;
      width: px-to-rem(40px);
    }
  }

  output {
    display: inline-block;
    width: px-to-rem(32px);
    text-align: center;
    font-size: px-to-rem(20px);
    margin: px-to-rem(10px) 2.5% 0 5%;
  }

  /* delete? */
  path {
    stroke: $black;
  }

  .title-block {
    p {
      margin: 0;
    }
    .track-title {
      font-size: px-to-rem(20px);
      line-height: 1.5em;
    }
  }

  .play-block {
    display: flex;
    flex-flow: row nowrap;
    align-items: center;
    justify-content: space-between;
  }

  .play-pause-button {
    @include background-svg("<svg width='18' height='22' viewBox='0 0 18 22' xmlns='http://www.w3.org/2000/svg'><path d='M1,-0.233809621 C-0.1045695,-0.233809621 -1,0.661620879 -1,1.76619038 L-1,16.2338096 C-1,16.5962975 -0.901484333,16.9519703 -0.714985851,17.2628011 C-0.146689532,18.2099617 1.08183098,18.5170918 2.02899151,17.9487955 L14.0853409,10.7149859 C14.3668401,10.5460863 14.6024357,10.3104907 14.7713352,10.0289915 C15.3396315,9.08183098 15.0325014,7.85331047 14.0853409,7.28501415 L2.02899151,0.0512045275 C1.76996584,-0.104210874 1.47979989,-0.198527098 1.18049997,-0.225648745 L1,-0.233809621 Z M1,16.232 L1,1.767 L13.0563494,9 L1,16.232 Z' transform='translate(2 2)' fill='#383B41'/></svg>");
    height: px-to-rem(22px);
    width: px-to-rem(18px);    
    margin: px-to-rem(20px) px-to-rem(6px) px-to-rem(10px) 0;

    &.playing {
      @include background-svg("<svg width='18' height='22' viewBox='0 0 18 22' xmlns='http://www.w3.org/2000/svg'><path d='M9 2 6 2C4.8954305 2 4 2.8954305 4 4L4 20C4 21.1045695 4.8954305 22 6 22L9 22C10.1045695 22 11 21.1045695 11 20L11 4C11 2.8954305 10.1045695 2 9 2ZM6 4 9 4 9 20 6 20 6 4ZM18 2 15 2C13.8954305 2 13 2.8954305 13 4L13 20C13 21.1045695 13.8954305 22 15 22L18 22C19.1045695 22 20 21.1045695 20 20L20 4C20 2.8954305 19.1045695 2 18 2ZM15 4 18 4 18 20 15 20 15 4Z' transform='translate(-3 -1)' fill='#383B41'/></svg>");
    }
  }

  .time {
    display: inline-block;
    text-align: center;
    font-size: px-to-rem(16px);
    margin: px-to-rem(28.5px) 0 px-to-rem(18.5px) 0;

    &.current-time {
      margin-right: px-to-rem(6px);
      text-align: right;
      width: px-to-rem(64px);
    }

    &.duration {
      margin-left: px-to-rem(6px);
    }
  }

  .seek-slider {
    $track_height: px-to-rem(12px);
    $border_width: px-to-rem(2px);
    $track_border: $border_width solid $black;
    $thumb_size: px-to-rem(8px);

    -webkit-appearance: none;
    flex-grow: 2;
    flex-shrink: 2;
    margin: px-to-rem(8px) px-to-rem(6px) 0 px-to-rem(6px);
    min-width: px-to-rem(70px);
    position: relative;

    /* webkit range input customization */
    &::-webkit-slider-runnable-track {
      background: $white;
      border: $track_border;
      cursor: pointer;
      height: $track_height;
      width: 100%;
    }
    &::before {
      position: absolute;
      content: "";
      top: 0;
      left: 0;
      height: $track_height;
      background-color: $black;
      border: $track_border;
      cursor: pointer;
      width: var(--seek-before-width);
    }
    &::-webkit-slider-thumb {
      -webkit-appearance: none;
      position: relative;
      box-sizing: border-box;
      border: none;
      height: $track_height - (2 * $border_width);
      width: $thumb_size;
      background: $black;
      border-radius: 0;
      cursor: pointer;
      margin: 0;
    }
    &:active::-webkit-slider-thumb {
      transform: scaleY(2) scaleX(1.5);
      background: $black;
    }

    /* firefox range input customization */
    &::-moz-range-track {
      width: 100%;
      height: $track_height;
      cursor: pointer;
      background: $white;
      border: $track_border;
    }
    &::-moz-range-progress {
      background-color: $black;
      height: $track_height;
    }
    &::-moz-focus-outer {
      border: 0;
    }
    &::-moz-range-thumb {
      box-sizing: content-box;
      border: $track_border;
      height: $track_height;
      width: math.div($thumb_size, 2);
      background-color: $black;
      border-radius: 0;
      cursor: pointer;
    }
    &:active::-moz-range-thumb {
      transform: scale(1.2);
      background: $black;
    }

    /* old IE range customization */
    &::-ms-track {
      width: 100%;
      height: $track_height;
      cursor: pointer;
      background: $white;
      border: $track_border;
      color: transparent;
    }
    &::-ms-fill-lower {
      background-color: $black;
    }
    &::-ms-fill-upper {
      background-color: $white;
    }
    &::-ms-thumb {
      box-sizing: content-box;
      border: $track_border;
      height: $track_height;
      width: math.div($thumb_size, 2);
      background-color: $black;
      border-radius: 0;
      cursor: pointer;
    }
    &:active::-ms-thumb {
      background: $black;
    }
  }

  .volume-block {
    display: none;
  }

  .mute-button {
    @include background-svg("<svg width='22' height='18' viewBox='0 0 22 18' xmlns='http://www.w3.org/2000/svg'><g transform='translate(2 2)' stroke='#383B41' stroke-width='2' fill='none' fill-rule='evenodd' stroke-linecap='round'><path d='M-0.585786438,2 L10.5857864,2 C11.1380712,2 11.5857864,2.44771525 11.5857864,3 C11.5857864,3.26521649 11.4804296,3.5195704 11.2928932,3.70710678 L8,7 L8,7 L8,11 C8,11.5522847 7.55228475,12 7,12 L3,12 C2.44771525,12 2,11.5522847 2,11 L2,7 L2,7 L-1.29289322,3.70710678 C-1.68341751,3.31658249 -1.68341751,2.68341751 -1.29289322,2.29289322 C-1.10535684,2.10535684 -0.851002927,2 -0.585786438,2 Z' stroke-linejoin='round' transform='rotate(90 5 7)'/><path d='M19.9497475,2.05025253 C14.313371,2.05025253 10.0502525,6.28203159 10.0502525,11.9497475' transform='rotate(135 15 7)'/><path d='M15.8284271,4.17157288 C12.8786247,4.17157288 10.1715729,6.87862471 10.1715729,9.82842712' transform='rotate(135 13 7)'/><path d='M11.7071068,6.29289322 C10.9934645,6.29289322 10.2928932,6.99346449 10.2928932,7.70710678' transform='rotate(135 11 7)'/></g></svg>");
    height: px-to-rem(18px);
    width: px-to-rem(22px);
    margin: 0 px-to-rem(6px) 0 0;

    &.muted {
      @include background-svg("<svg width='22' height='18' viewBox='0 0 22 18' xmlns='http://www.w3.org/2000/svg'><g transform='translate(2 2)' stroke='#383B41' stroke-width='2' fill='none' fill-rule='evenodd' stroke-linecap='round'><path d='M-0.585786438,2 L10.5857864,2 C11.1380712,2 11.5857864,2.44771525 11.5857864,3 C11.5857864,3.26521649 11.4804296,3.5195704 11.2928932,3.70710678 L8,7 L8,7 L8,11 C8,11.5522847 7.55228475,12 7,12 L3,12 C2.44771525,12 2,11.5522847 2,11 L2,7 L2,7 L-1.29289322,3.70710678 C-1.68341751,3.31658249 -1.68341751,2.68341751 -1.29289322,2.29289322 C-1.10535684,2.10535684 -0.851002927,2 -0.585786438,2 Z' stroke-linejoin='round' transform='rotate(90 5 7)'/><path d='M11.7071068,6.29289322 C10.9934645,6.29289322 10.2928932,6.99346449 10.2928932,7.70710678' transform='rotate(135 11 7)'/></g></svg>");
    }
  }

  .volume-slider {
    $track_height: px-to-rem(4px);
    $track_radius: px-to-rem(2px);
    $thumb_size: px-to-rem(20px);
    $thumb_border_size: px-to-rem(4px);
    $thumb_border: $thumb_border_size solid $black;

    -webkit-appearance: none;
    flex-grow: 2;
    margin: 0 0 0 px-to-rem(6px);
    min-width: px-to-rem(70px);
    position: relative;

    /* webkit range input customization */
    &::-webkit-slider-runnable-track {
      background: $black-olive;
      border-radius: $track_radius;
      cursor: pointer;
      height: $track_height;
      width: 100%;
    }
    &::before {
      position: absolute;
      content: "";
      top: 0;
      left: 0;
      height: $track_height;
      background-color: $black;
      border-radius: $track_radius;
      cursor: pointer;
      width: var(--volume-before-width);
    }
    &::-webkit-slider-thumb {
      -webkit-appearance: none;
      position: relative;
      box-sizing: content-box;
      border: $thumb_border;
      height: $thumb_size;
      width: $thumb_size;
      border-radius: 50%;
      background-color: $white;
      cursor: pointer;
      margin: math.div(-($thumb-size + $track_height), 2) 0 0 0;
    }
    &:active::-webkit-slider-thumb {
      transform: scale(1.2);
      background: $black;
    }

    /* firefox range input customization */
    &::-moz-range-track {
      width: 100%;
      height: $track_height;
      border-radius: $track_radius;
      cursor: pointer;
      background: $black-olive;
    }
    &::-moz-range-progress {
      background-color: $black;
      border-radius: $track_radius;
      height: $track_height;
    }
    &::-moz-focus-outer {
      border: 0;
    }
    &::-moz-range-thumb {
      box-sizing: content-box;
      border: $thumb_border;
      height: $thumb_size;
      width: $thumb_size;
      border-radius: 50%;
      background-color: $white;
      cursor: pointer;
    }
    &:active::-moz-range-thumb {
      transform: scale(1.2);
      background: $black;
    }

    /* old IE range customization */
    &::-ms-track {
      width: 100%;
      height: $track_height;
      cursor: pointer;
      background: transparent;
      border-color: transparent;
      border-width: math.div($thumb_border_size + $thumb_size - $track_height, 2) 0;
      color: transparent;
    }
    &::-ms-fill-lower {
      background-color: $black;
    }
    &::-ms-fill-upper {
      background-color: $black-olive;
    }
    &::-ms-thumb {
      box-sizing: content-box;
      border: $thumb_border;
      height: $thumb_size;
      width: $thumb_size;
      border-radius: 50%;
      background-color: #fff;
      cursor: pointer;
    }
    &:active::-ms-thumb {
      background: $black;
    }
  }

  .volume-output {
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    height: px-to-rem(1px);
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: px-to-rem(1px);
  }

  .transcript-container {
    position: relative;
    margin-left: px-to-rem(-18px);
    margin-right: px-to-rem(-18px);

    &.open {
      background: $gray;

      .transcript-text {
        display: block;
      }
    }

    .transcript-button {
      display: block;
      margin: 1rem auto 0;
    }

    .transcript-text {
      /* TODO: @include type_content; */
      background: $gray;
      display: none;
      padding: 1rem 1rem 0;
      position: absolute;
      top: px-to-rem(38px); 
      left: 0;
      right: 0;
      z-index: 1000;

      .transcript-close-button {
        display: block;
        margin: 0 auto 1rem;
      }
    }
  }
}
@media screen and (min-width: $desktop) {
  .audio-player-container {
    .time {
      font-size: px-to-rem(20px);
    }
    .play-pause-button {
      height: px-to-rem(44px);
      width: px-to-rem(36px);
    }
    .mute-button {
      height: px-to-rem(36px);
      width: px-to-rem(44px);
    }
    .transcript-container {
      position: static;

      .transcript-text {
        top: px-to-rem(40px);
        /*
        left: $tablet-side-margin;
        right: $tablet-side-margin;
        */
      }
    }
    .volume-block {
      display: flex;
      flex-flow: row nowrap;
      align-items: center;
      justify-content: space-between;
    }
  }  
}
/*
@include tablet {
  .audio-player-container {
    .time {
      font-size: px-to-rem(20px);
    }
    .play-pause-button {
      height: px-to-rem(44px);
      width: px-to-rem(36px);
    }
    .mute-button {
      height: px-to-rem(36px);
      width: px-to-rem(44px);
    }
    .transcript-container {
      position: static;

      .transcript-text {
        top: px-to-rem(40px);
        left: $tablet-side-margin;
        right: $tablet-side-margin;
      }
    }
    .volume-block {
      display: flex;
      flex-flow: row nowrap;
      align-items: center;
      justify-content: space-between;
    }
  }
}

@include small-desktop {
  .audio-player-container {
    .transcript-container {
      .transcript-text {
        font-size: px-to-rem(24px);
        left: $small-desktop-side-margin;
        right: $small-desktop-side-margin;
      }
    }
  }
}

@include desktop {
  .audio-player-container {
    .transcript-container {
      .transcript-text {
        font-size: px-to-rem(28px);
        left: $desktop-side-margin;
        right: $desktop-side-margin;
      }
    }
  }
}
*/